/*
Module: relabelings-static
Description: Handles relabelings to add static labels to all targets, this isn't possible to do dynamically at the moment,
             so we simply look for commonly accepted labels that might be added i.e. cluster, env, team, squad, region, etc.
*/

argument "static_labels" {
  // comment = "Static labels to add to every collected metrics"
  optional = true
  default = {}
}

export "relabelings" {
  value = discovery.relabel.static
}

discovery.relabel "static" {
  targets = argument.targets.value

  rule {
    action = "replace"
    replacement = coalesce(argument.static_labels.value.cluster, "")
    target_label = "cluster"
  }

  rule {
    action = "replace"
    replacement = coalesce(argument.static_labels.value.env, "")
    target_label = "env"
  }

  rule {
    action = "replace"
    replacement = coalesce(argument.static_labels.value.region, "")
    target_label = "region"
  }

  rule {
    action = "replace"
    replacement = coalesce(argument.static_labels.value.team, "")
    target_label = "team"
  }

  rule {
    action = "replace"
    replacement = coalesce(argument.static_labels.value.squad, "")
    target_label = "squad"
  }

  rule {
    action = "replace"
    replacement = coalesce(argument.static_labels.value.platform, "")
    target_label = "platform"
  }

}
